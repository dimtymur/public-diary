<?php
$query_like   = "SELECT count(*) AS like_amt
                 FROM mpd_comm_like
                 WHERE comm_id = ?;";
$query_liked  = "SELECT count(*) AS like_amt
                 FROM mpd_comm_like
                 WHERE comm_id = ?
                 AND user_id = ?;";

$post_page = $dimport["post/post_page.phtml"]["redirect"];
foreach ($comms as $comm) {
    $user      = $records_get("mpd_user", "user_id", $comm["user_id"])[0];
    $like_amt  = $sql_query($query_like, [$comm["comm_id"]])[0]["like_amt"];
    $liked     = $sql_query($query_liked, [$comm["comm_id"], $_SESSION["u_id"]])[0]["like_amt"]; ?>
    <div class="theme-box page-item media comment" id='<?= $comm["comm_id"] ?>'>
        <div class="media-bar">
            <a class="media-bar-item" href='index.php?page=profile/profile_page.phtml&user-id=<?= $user["user_id"] ?>'> <?= $user["username"] ?> </a>
            <div class="media-bar-item media-bar-info main-date date"> <?= $comm["comm_dt"] ?> </div>
            <div class="float-right">
                <div class="dropdown" tabindex="0">
                    <div class="dropdown-btn">• • •</div>
                    <ul class="dropdown-cont position-right">
                        <?php if ($_SESSION["u_id"] == $post["user_id"]) { ?>
                            <li class="dropdown-item comment-del-btn"> Delete </li>
                            <li class="dropdown-item comment-edit-btn" href='<?= $post_page."&post-id=".$comm["post_id"]."&comm-id=".$comm["comm_id"] ?>'> Edit </li>
                        <?php } else { ?>
                            <li class="dropdown-item"> Report </li>
                        <?php } ?>
                    </ul>
                </div>
            </div>
        </div>
        <div class="media-cont">
            <div class="media-text see-more-text"> <?= $comm["comm"] ?> </div>
        </div>
        <div class="see-more"> See More </div>
        <div class="media-bar">
            <div class="media-bar-item like-btn">
                <img class="invert-icon media-bar-icon like-icon check{state:<?= $liked ?>}" src="/img/icons/heart-icon.png">
                <div class="media-bar-icon-value like-amt"> <?= $like_amt ?> </div>
            </div>
            <div class="media-bar-item float-right">
                <?php if (empty($post)) { ?>
                    <a href="<?= $post_page."&post-id=".$comm["post_id"] ?>">
                        <img class='invert-icon media-bar-icon' src='/img/icons/source-icon.png'>
                    </a>
                <?php } ?>
            </div>
        </div>
    </div>
<?php }

$alter_form = "comment";
require $dimport["common/alter_forms.phtml"]["path"];
